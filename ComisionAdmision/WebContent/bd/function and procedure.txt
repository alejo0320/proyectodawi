DELIMITER $$

DROP FUNCTION IF EXISTS `bd_comisionadmision`.`insertarPostulante` $$
CREATE FUNCTION `insertarPostulante`(Nombres varchar(50),apepat varchar(50),apemat varchar(50),
fechanac varchar(50),dnip varchar(50),email varchar(50),telefono varchar(50),foto blob,estado varchar(50),codcarrera int,
codtipomodalidad int) RETURNS int(11)
BEGIN
      DECLARE aprobacion INT;
      declare codigopostulante int;
      SET aprobacion = verificarDNI(dnip);
      if aprobacion = 0   then
    insert into Postulante(codpostulante,NOMBRES,APEPAT,APEMAT,
    FECHANAC,DNI,EMAIL,TELEFONO,FOTO,ESTADO,CODCARRERA,codtipomodalidad) values(null,Nombres,apepat,apemat,fechanac,
    dnip,email,telefono,foto,estado,codcarrera,codtipomodalidad);
    select codpostulante into codigopostulante from postulante where dni=dnip;
    return codigopostulante;
    else   return 0;
    end if;
END $$

DELIMITER ;


DELIMITER $$

DROP FUNCTION IF EXISTS `bd_comisionadmision`.`verificarDNI` $$
CREATE FUNCTION `verificarDNI`(dnip varchar(50)) RETURNS int(11)
BEGIN
    Declare verificarDNI varchar(50);
    declare codigoPostulante int;
    select dni,codpostulante into verificarDNI,codigoPostulante
    from postulante
    where dni=dnip;
            if verificarDNI=dnip then
            return codigoPostulante;
            else   return 0;
            end if;
END $$

DELIMITER ;


DELIMITER $$

DROP FUNCTION IF EXISTS `bd_comisionadmision`.`apruebaSolicitud` $$
CREATE FUNCTION `bd_comisionadmision`.`apruebaSolicitud` (nSolicitud int) RETURNS INT
BEGIN


    Declare totalRequisitos int;
    declare totalmisRequisitos int;



    SELECT count(r.codrequisito) into totalRequisitos FROM postulante p inner join solicitud s on s.codpostulante=p.codpostulante inner join
    requisitoxmodalidad r on p.codtipomodalidad=r.codtipomodalidad
    where s.nrosolicitud=nSolicitud;
    SELECT count(codrequisito) into totalmisRequisitos FROM detallesolicitud where nrosolicitud=nSolicitud and estado='aprobado';

            if totalRequisitos=totalmisRequisitos then
            update solicitud set estado='aprobado' where nroSolicitud=nSolicitud;
            return 1;
            else   return -1;
            end if;
END $$

DELIMITER ;



/*

ya no utilize este procedure ni el hilo ya todo esta bacan para q ejecuten no mas paso a paso rechazen hagan lo q quieran
XD oeigan hagan el res miren la hora q le estoy mandando todo

DELIMITER $$

DROP PROCEDURE IF EXISTS `bd_comisionadmision`.`datos_solicitud` $$
CREATE PROCEDURE `bd_comisionadmision`.`datos_solicitud` (IN solicitud integer)
BEGIN
        select count(estado) from detallesolicitud where nrosolicitud=solicitud and estado = 'pendiente' or estado='desaprobado';

END $$

DELIMITER ;





Jesus hize mi select porq tu super select tava mal XD



SELECT distinct r.codrequisito,r.nombre FROM requisitoxmodalidad rm inner join requisito r on rm.codrequisito=r.codrequisito
inner join postulante p on p.codtipomodalidad=rm.codtipomodalidad where p.codpostulante=16 and NOT exists (select d.codrequisito from solicitud s inner join
detallesolicitud d on s.nrosolicitud=d.nrosolicitud where d.codrequisito = r.codrequisito and s.codpostulante=16)
*/